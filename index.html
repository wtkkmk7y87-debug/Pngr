<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>åœ°å›³ãƒ†ã‚¹ãƒˆ</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
html, body {
 height: 100%;
 margin: 0;
}
#map {
 width: 100%;
 height: 100%;
 background: #ddd;
}
button {
 position: fixed;
 top: 10px;
 left: 10px;
 z-index: 1000;
}
</style>
</head>
<body>
<button onclick="getLocation()">ğŸ“ç¾åœ¨åœ°</button>
<button onclick="setGoal()">ğŸ¯ç›®çš„åœ°</button>
<div id="map"></div>
<script>
const imageWidth = 3312;   // â† ä»®ã®æ•°å­—ã§OK
const imageHeight = 3392; // â† ä»®ã®æ•°å­—ã§OK
const bounds = [[0,0], [imageHeight, imageWidth]];
const map = L.map('map', {
 crs: L.CRS.Simple,
 minZoom: -2,
 maxZoom: 2
});
L.imageOverlay('map.png', bounds).addTo(map);
map.fitBounds(bounds);
let myMarker, goalMarker, routeLine;

// ç¾åœ¨åœ°å–å¾—

function getLocation() {

  navigator.geolocation.getCurrentPosition(pos => {
  const lat = pos.coords.latitude;
  const lng = pos.coords.longitude;

    // â€» ã„ã¾ã¯ä»®ã§ä¸­å¤®ã«è¡¨ç¤ºï¼ˆã‚ã¨ã§æ­£ç¢ºå¤‰æ›ã™ã‚‹ï¼‰

    const x = imageWidth / 2;

    const y = imageHeight / 2;

    if(myMarker) map.removeLayer(myMarker);

    myMarker = L.marker([y, x]).addTo(map)

      .bindPopup("ç¾åœ¨åœ°").openPopup();

    drawRoadRoute();

  });

}

// ç›®çš„åœ°ã‚»ãƒƒãƒˆ

function setGoal() {

  alert("åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ç›®çš„åœ°ã‚’æ±ºã‚ã¦ã­");

  map.once("click", e => {

    if(goalMarker) map.removeLayer(goalMarker);

    goalMarker = L.marker(e.latlng).addTo(map)

      .bindPopup("ç›®çš„åœ°").openPopup();

    drawRoadRoute();

  });
 function drawRoadRoute() {
  if (!myMarker || !goalMarker) return;

  // æ—¢å­˜ãƒ«ãƒ¼ãƒˆå‰Šé™¤
  if (routeLine) map.removeLayer(routeLine);

  const from = myMarker.getLatLng();
  const to   = goalMarker.getLatLng();

  routeLine = L.polyline([from, to], {
    color: 'blue',
    weight: 4
  }).addTo(map);

  map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
}


}
 
</script>
</body>
</html>



