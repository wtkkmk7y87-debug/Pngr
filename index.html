<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>ç”»åƒåœ°å›³ Ã— GPS</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
html, body {
  height: 100%;
  margin: 0;
}
#map {
  width: 100%;
  height: 100%;
}

/* GPSãƒœã‚¿ãƒ³ã‚’å¤§ãã */
#gpsBtn {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 1000;
  font-size: 22px;
  padding: 12px 18px;
  border-radius: 10px;
  border: none;
  background: #2c7be5;
  color: white;
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
#status {
  position: fixed;
  bottom: 15px;
  left: 15px;
  z-index: 1000;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 10px 14px;
  border-radius: 8px;
  display: none;
  font-size: 16px;
}

/* ğŸ“ç›®çš„åœ°ç”¨ */
.pin {
  font-size: 30px;
}
</style>
</head>

<body>

<button id="gpsBtn">ğŸ“ GPSã‚’è¡¨ç¤º</button>
<div id="status"></div>
<div id="map"></div>

<script>
/* =====================
 â‘  ç”»åƒã‚µã‚¤ã‚º
===================== */
const imageWidth  = 1264;
const imageHeight = 1295;

/* =====================
 â‘¡ Leaflet åˆæœŸåŒ–
===================== */
const bounds = [[0,0],[imageHeight,imageWidth]];
const map = L.map("map", {
  crs: L.CRS.Simple,
  minZoom: -2,
  maxZoom: 2
});

L.imageOverlay("map.jpg", bounds).addTo(map);
map.fitBounds(bounds);

/* =====================
 â‘¢ ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼
===================== */
let currentMarker = null;
const status = document.getElementById("status");

/* =====================
 â‘£ GPSå‡¦ç†
===================== */
document.getElementById("gpsBtn").onclick = () => {
  navigator.geolocation.watchPosition(
    pos => {
      const x = pos.coords.longitude; // ä»®é…ç½®ï¼ˆç¢ºèªç”¨ï¼‰
      const y = pos.coords.latitude;

      // ä»Šå›ã¯ã€Œåœ°å›³ãŒå‡ºã‚‹ã€ã“ã¨ã‚’æœ€å„ªå…ˆ
      const px = imageWidth / 2;
      const py = imageHeight / 2;

      // ç¯„å›²ãƒã‚§ãƒƒã‚¯
      if (px < 0 || px > imageWidth || py < 0 || py > imageHeight) {
        status.textContent = "ç¾åœ¨åœ°ã¯åœ°å›³ã®ç¯„å›²å¤–ã§ã™";
        status.style.display = "block";
        return;
      }

      status.style.display = "none";

      if (!currentMarker) {
        currentMarker = L.marker([py, px])
          .addTo(map)
          .bindPopup("ç¾åœ¨åœ°")
          .openPopup();
      } else {
        currentMarker.setLatLng([py, px]);
      }
    },
    err => alert(err.message),
    { enableHighAccuracy: true }
  );
};

/* =====================
 â‘¤ ç›®çš„åœ°ï¼ˆğŸ“ï¼‰
===================== */
let goalMarker = null;

const pinIcon = L.divIcon({
  className: "pin",
  html: "ğŸ“",
  iconSize: [30, 30],
  iconAnchor: [15, 30]
});

map.on("click", e => {
  if (goalMarker) map.removeLayer(goalMarker);
  goalMarker = L.marker(e.latlng, { icon: pinIcon })
    .addTo(map)
    .bindPopup("ç›®çš„åœ°")
    .openPopup();
});
</script>

</body>
</html>
